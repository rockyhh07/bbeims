<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Barangka Ibaba Evacuation Information Management System</title>
   <link rel="shortcut icon" href="./asset/img/logo.png" type="image/x-icon">
   <!-- Google Font: Source Sans Pro -->
   <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">

   <!-- Theme style -->
   <link rel="stylesheet" href="asset/css/adminlte.min.css">

   <link rel="stylesheet" href="asset/css/login.css">
   <link rel="stylesheet" href="asset/css/font.css">
   <!-- Font Awesome -->
   <link rel="stylesheet" href="asset/fontawesome/css/all.min.css">

   <script src="./asset/js/constants.js"></script>
   <script src="./asset/js/redirect_to_admin.js"></script>
   <script src="./asset/jquery/jquery.min.js"></script>
   <script src="./asset/js/alert.js"></script>
</head>

<body class="hold-transition login-page">
   <div class="login-box">
      <!-- /.login-logo -->
      <div class="card card-outline card-info">
         <div class="card-header text-center">
            <a href="." class="brand-link">
               <img src="asset/img/logoa.png" alt="DSMS Logo" width="200">
            </a>
         </div>
         <div class="card-body">
            <form method="post" id="login-form">
               <div class="input-group mb-3">
                  <input name="username" type="text" class="form-control" placeholder="Username">
                  <div class="input-group-append">
                     <div class="input-group-text">
                        <span class="fas fa-user"></span>
                     </div>
                  </div>
               </div>
               <div class="input-group mb-3">
                  <input name="password" type="password" class="form-control" placeholder="Password">
                  <div class="input-group-append">
                     <div class="input-group-text">
                        <span class="fas fa-lock"></span>
                     </div>
                  </div>
               </div>
               <div class="row">
                  <div class="col-6 offset-3">
                     <button id="login-button" type="submit" class="btn btn-block btn-bg"
                        style="background-color: rgb(116, 152, 87);">Login</button>
                  </div>
               </div>
            </form>
            <div style="font-size: small; text-align: right; margin-top: 1rem;" onclick="privacy()">
               Read <a href="#">Privacy Policy</a>.
            </div>
         </div>
         <!-- /.card-body -->
      </div>
      <!-- /.card -->
   </div>
   <!-- /.login-box -->
</body>

</html>

<script>
   async function privacy() {
      await fetch(`${BASE_URL}asset/templates/privacyPolicy.html`)
      .then(response => response.text())
      .then(response => {
         show_alert({
            title: "<div style='font-size: large; font-weight: bold;'>Privacy policy</div>",
            body: response,
            buttons: ["Close"]
         });
      })
      .catch(err => console.error(err));

   }

   document.getElementById('login-button').addEventListener("click", async function (e) {
      e.preventDefault();
      const form = new FormData(document.getElementById('login-form'));
      await fetch(BASE_URL + 'php/user_login.php', {
         method: 'post',
         body: form
      })
      .then(response => response.json())
      .then(response => {
         let result = response.result;
         if (!result) addNotif('Login failed', 'Invalid Username or password', 'r');
         else {
            window.sessionStorage.setItem("user_data", JSON.stringify(result[0]));
            window.location.href = BASE_URL + 'admin/'
         };
      })
      .catch(err => {
         console.error("ERROR: " + err);
      });
   });


   /**
    * For Notifications
    */
   const notifHolder = document.createElement("div");
   (function () {
      notifHolder.style.position = "fixed";
      notifHolder.style.width = "300px";
      notifHolder.style.bottom = "5px";
      notifHolder.style.right = "0";
      notifHolder.style.zIndex = "100";
      notifHolder.style.display = "flex";
      notifHolder.style.flexDirection = "column-reverse";
      document.querySelector("body").append(notifHolder);
   })();

   function addNotif(title, message, flag) {

      let tColor =
         (flag == "g") ? "#C8FEE0" :
            (flag == "r") ? "#FFAFAA" :
               "#ECECEC";

      let bColor =
         (flag == "g") ? "#EAFAF1" :
            (flag == "r") ? "#FDEDEC" :
               "#F8F9F9";

      const notif = document.createElement("section");
      notif.setAttribute("class", "notif shadow slide-in-out");
      notif.addEventListener("animationend", () => {
         notif.remove();
      })
      // notif.style.border = "1px solid " + tColor;
      notif.style.backgroundColor = bColor;

      const notif_close = document.createElement("button");
      notif_close.setAttribute("class", "notif_close_btn");
      notif_close.innerHTML = '<i class="fas fa-times"></i>';
      notif_close.style.position = "absolute";
      notif_close.style.top = "5px";
      notif_close.style.right = "5px";
      notif_close.style.background = "none";
      notif_close.style.border = "none";
      // notif_close.style.border = `1px solid ${tColor}`;
      // notif_close.style.backgroundColor = bColor;
      notif_close.addEventListener("click", () => {
         notif.remove();
         if (notifHolder.children.length == 0) {
            notifHolder.classList.add("hide");
         }
      });

      const notif_title = document.createElement("section");
      notif_title.setAttribute("class", "notif-title fw-bold d-flex align-items-center");
      notif_title.style.gap = ".5rem";
      notif_title.style.backgroundColor = tColor;

      const title_content = document.createElement('spam');
      title_content.innerHTML = title;
      notif_title.appendChild(title_content);

      const notif_body = document.createElement("section");
      notif_body.setAttribute("class", "notif-body");
      notif_body.innerHTML = message;

      notif.appendChild(notif_close);
      notif.appendChild(notif_title);
      notif.appendChild(notif_body);


      if (notifHolder.children.length < 3) {
         notifHolder.classList.remove("hide");
         notifHolder.appendChild(notif);
      }
      else {
         notifHolder.children[0].remove()
         notifHolder.appendChild(notif);
      }
   }
</script>