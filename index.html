<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Barangka Ibaba Evacuation Information Management System</title>
   <!-- Google Font: Source Sans Pro -->
   <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
   
   <!-- Theme style -->
   <link rel="stylesheet" href="asset/css/adminlte.min.css">

   <link rel="stylesheet" href="asset/css/login.css">
   <link rel="stylesheet" href="asset/css/font.css">
   <!-- Font Awesome -->
   <link rel="stylesheet" href="asset/fontawesome/css/all.min.css">

   <script src="./asset/js/constants.js"></script>
   <script src="./asset/js/redirect_to_admin.js"></script>
</head>

<body class="hold-transition login-page">
   <div class="login-box">
      <!-- /.login-logo -->
      <div class="card card-outline card-info">
         <div class="card-header text-center">
            <a href="." class="brand-link">
               <img src="asset/img/logo.png" alt="DSMS Logo" width="200">
            </a>
         </div>
         <div class="card-body">
            <form method="post" id="login-form">
               <div class="input-group mb-3">
                  <input name="username" type="text" class="form-control" placeholder="Username">
                  <div class="input-group-append">
                     <div class="input-group-text">
                        <span class="fas fa-user"></span>
                     </div>
                  </div>
               </div>
               <div class="input-group mb-3">
                  <input name="password" type="password" class="form-control" placeholder="Password">
                  <div class="input-group-append">
                     <div class="input-group-text">
                        <span class="fas fa-lock"></span>
                     </div>
                  </div>
               </div>
               <div class="row">
                  <div class="col-6 offset-3">
                     <button id="login-button" type="submit" class="btn btn-block btn-bg"
                        style="background-color: rgb(116, 152, 87);">Login</button>
                  </div>
               </div>
            </form>
         </div>
         <!-- /.card-body -->
      </div>
      <!-- /.card -->
   </div>
   <!-- /.login-box -->
</body>

</html>

<script>
   document.getElementById('login-button').addEventListener("click", async function (e) {
      e.preventDefault();
      const form = new FormData(document.getElementById('login-form'));
      await fetch(BASE_URL + 'php/user_login.php', {
         method: 'post',
         body: form
      })
      .then(response => response.json())
      .then(response => {
         let result = response.result;
         if (!result) alert('Invalid Username or password');
         else {
            window.sessionStorage.setItem("user_data", JSON.stringify(result[0]));
            window.location.href = BASE_URL + 'admin/'
         };
      })
      .catch(err => {
         console.error("ERROR: " + err);
      });
   });
</script>